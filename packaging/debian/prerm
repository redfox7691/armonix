#!/bin/sh
set -e

if command -v systemctl >/dev/null 2>&1; then
    if [ "$1" = "remove" ] || [ "$1" = "upgrade" ]; then
        systemctl stop armonix.service >/dev/null 2>&1 || true
        if command -v loginctl >/dev/null 2>&1; then
            loginctl list-users --no-legend 2>/dev/null | awk 'NR>1 {print $2}' | while read -r user; do
                [ -z "$user" ] && continue
                [ "$user" = "root" ] && continue
                runuser -l "$user" -c "systemctl --user stop armonix-gui.service >/dev/null 2>&1 || true" || true
            done || true
        fi
    fi
fi

exit 0
