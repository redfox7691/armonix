." Manpage for Armonix
.TH ARMONIX 1 "March 2024" "Version 0.99" "User Commands"
.SH NAME
armonix \- controller MIDI per tastiere Ketron
.SH SYNOPSIS
.B armonix
[
.B --config
.I file
]
[
.B --headless
|
.B --gui
]
[
.B --master
.RI { fantom \| launchkey }
]
[
.B --verbose
|
.B --no-verbose
]
[
.B --disable_realtime_display
|
.B --enable_realtime_display
]
.SH DESCRIPTION
.B Armonix
è un servizio Python che gestisce il flusso dei messaggi MIDI tra la master keyboard
e la tastiera Ketron, fornendo il controllo dei LED, del keypad e delle funzioni
personalizzate. Il programma può essere eseguito in modalità 
.I headless
(senza interfaccia grafica) oppure con l'interfaccia PyQt5 che mostra lo stato dei LED.
.P
Il comando principale legge la configurazione da
.I /etc/armonix/armonix.conf
se presente, oppure dai file predefiniti installati con il pacchetto. I log
vengono inviati al syslog di sistema; quando l'opzione 
.B verbose=true
nel file di configurazione (o l'opzione
.B --verbose
da riga di comando) è attiva vengono registrati anche i messaggi di debug.
.SH CONFIGURAZIONE
Il file
.I /etc/armonix/armonix.conf
contiene le principali impostazioni:
.TP
.B [armonix]
Definisce la master keyboard da utilizzare ("launchkey" o "fantom"), la modalità di
avvio (headless=true/false), l'abilitazione dei log dettagliati e la gestione del display.
.TP
.B [midi]
Permette di specificare le stringhe da cercare per individuare le porte MIDI della master,
della Ketron e di eventuali dispositivi Bluetooth. Lasciare il campo vuoto per utilizzare i
valori predefiniti.
.TP
.B [keypad]
Imposta il percorso del device eventi del keypad USB.
.TP
.B [wifi]
Sezione opzionale che replica il comportamento dello script storico
.I start-touchdesk.sh
. Quando sono impostati 
.B ssid
e
.B vnc_command
il servizio controlla periodicamente la rete Wi-Fi connessa e avvia il comando VNC specificato
quando viene rilevata la rete indicata. È possibile impostare variabili d'ambiente come
.B display
e
.B xdg_runtime_dir
per preparare la sessione grafica.
.P
I file
.I /etc/armonix/keypad_config.json
e
.I /etc/armonix/launchkey_config.json
definiscono rispettivamente le mappature del keypad e della Launchkey.
.SH FILES
.TP
.I /usr/lib/armonix
Contiene il codice Python dell'applicazione e le configurazioni di default.
.TP
.I /etc/armonix
Directory con i file di configurazione modificabili dall'utente.
.TP
.I /usr/share/armonix/examples
Copia dei file di configurazione di fabbrica. Per ripristinare le impostazioni
iniziali è sufficiente copiare i file desiderati in
.I /etc/armonix
e riavviare il servizio.
.TP
.I /usr/lib/systemd/system/armonix.service
Unità di servizio systemd utilizzata per eseguire Armonix all'avvio.
.SH SERVIZIO
Il pacchetto installa automaticamente l'unità
.B armonix.service
che viene eseguita come utente non privilegiato
.B armonix
e si avvia all'accensione del sistema. Il servizio può essere gestito con
.B systemctl
(
.B systemctl status armonix
,
.B systemctl restart armonix
,
ecc.).
.SH TROUBLESHOOTING
Per identificare i nomi delle porte MIDI disponibili è possibile utilizzare il comando
.B aplaymidi -l
per le uscite e
.B amidi -l
per le porte raw, oppure eseguire il comando
.B python3 -m mido.list_ports
che elenca tutte le porte viste da Mido. Inserire quindi le stringhe rilevanti nelle chiavi
appropriate della sezione
.B [midi]
del file di configurazione.
.P
I log di Armonix sono disponibili nel syslog di sistema (ad esempio consultando
.B journalctl -u armonix
).
.SH SEE ALSO
.BR systemctl (1),
.BR journalctl (1)
